!function(){var e={jquery:function(e){"use strict";e.exports=jQuery}},t={};!function(){var a=function a(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,a),o.exports}("jquery");function n(e,t){var n=1===t.data("from_report"),r=window._CONFIG.is_community_manager,o=window._CONFIG.is_group_manager,s=t.data("is_group_member"),i="";if(n){var c=1===t.data("is_remove_comment"),l=t.data("topic_id")+"",d=t.data("comment_id")+"";i=t.data("reason")}if(window._USER_ABNORMAL){window.show_abnormal&&window.show_abnormal();return}var p={douban:[],group:[]},u=window._CONFIG[e+"_reasons"];u.douban_reasons&&(p.douban=[u.douban_reasons.filter(function(e){return 1===e.type}),u.douban_reasons.filter(function(e){return 2===e.type})]),u.group_reasons&&(p.group=[u.group_reasons.filter(function(e){return"其他"!==e.subtitle}),u.group_reasons.filter(function(e){return"其他"===e.subtitle})]);var m=function(e,t,a,n,r,o){var s="";return o&&o.length>86?s='<p class="reason-desc" '+(i===e?'style="display: block;"':"")+'><span class="short-rsn-desc">'+o.substring(0,86)+'</span>...<a href="javascript:void(0);" class="show-full">展开</a></p><p class="full-rsn-desc">'+o+"</p>":o&&o.length<=86&&(s='<p class="reason-desc" '+(i===e?'style="display: block;"':"")+">"+o+"</p>"),'<li><label><input type="radio"name="rej-rsn"'+(a?'data-holder="'+a+'"':"")+(n?'data-msg="1"':"")+(r?'data-csm="1"':"")+(i===e?'checked="true"':"")+'data-type="'+t+'"class="rej-rsn '+(a?"custom":"")+'"value="'+e+'"/>'+e+s+"</label></li>"},f=null;"delete_comment"===e?f=s?"移出小组并永久拒绝入组":"永久拒绝入组":"ban"===e?f="同时删除用户在本小组的所有发言和回应":t.data("can_set_notify")&&(f="同时发豆邮");var g=window.generate_group_prompt_dialog({content:function(){if(r&&!o)return'<div class="rej-cnt"><div class="community-manager-action"><p class="sub-t" style="margin-left: 20px;">违反豆瓣社区指导原则<span style="color: #ff7b4d; padding-left: 10px;">(仅社区管理员可见可操作)</span></p><textarea class="community-manager-ctm-rsn" type="text" name="rej-rsn-custom" placeholder="请输入理由或附言" /></div></div>';var e=[],t="",a=function(a){for(var n,r="",o=0;o<a.length;o++)r+=((n=a[o]).subtitle&&n.subtitle!==t&&(t=n.subtitle,e.push('<p class="sub-t">'+t+"</p>")),m(n.reason,n.type,n.placeholder,n.need_message,n.need_custom_reason,n.desc));return r};return e.push('<p style="font-weight: 500;">组内事务</p>'),p.group.forEach(function(t){t&&e.push("<ul>"+a(t)+"</ul>")}),e.push('<p style="font-weight: 500;">违反豆瓣社区指导原则</p>'),p.douban.forEach(function(t){e.push("<ul>"+a(t)+"</ul>")}),'<div class="rej-cnt">'+e.join("")+"</div>"}(),title:"选择"+({ban:"永久拒绝",delete_topic:"删除帖子",delete_comment:"删除回复"})[e]+"的理由",prompt:f,checked:!1,callback:function(s){var i=a(".rej-rsn:checked"),p=i.val(),u=null,m=i.data("type"),f=1===i.data("msg"),g=1===i.data("csm");if(!m&&!r){alert("请选择原因");return}var _={timestamp:new Date().getTime(),reason:p,type:m},h=t.attr("href");if(n){var v="/j/group/topic/"+l+"/manager_remove",b="/j/group/topic/"+l+"/manager_remove_comment";_=a.extend(_,{from_report:"1"}),c?(h=b,_=a.extend(_,{cid:d})):(h=v,_=a.extend(_,{topic_id:l}))}else _=a.extend(_,{cid:t.data("cid"),tids:t.data("tids")});if(u=r&&!o?a(".community-manager-ctm-rsn").val():a(".ctm-rsn").val())g?_.reason=u:_.message=u;else if(f||g){alert(i.data("holder"));return}if(a(".dui-dialog-prompt input").attr("checked")&&("ban"===e?_.delete_all=1:"delete_comment"===e?_.ban=1:t.data("can_set_notify")&&(_.notify="on")),a(".dui-dialog-content .btn-ok").append(a('<span class="loader">⌛</span>')),"ban"===e||_.tids)r&&!o&&(_.type=1,_.reason="违反社区指导原则"),a.post_withck(h,_,function(e){_.tids?window.location.reload():(t.closest(".member-item").remove(),a(".ban-dialog-confirm").closest("span.fleft").addClass("pl").html("已永拒"),_.delete_all&&a(".group-item .title a")[0].click())}),s.close();else if(n)a.ajax_withck({dataType:"json",type:"POST",url:h,data:_,success:function(e){0===e.r?(a(".dui-dialog-content .btn-ok span.loader").remove(),s.close(),setTimeout(function(){t.parents("li").eq(0).slideUp(200)},200)):(s.close(),pop_win('<div style="padding: 5px 15px;">'+e.msg+"</div>"))},error:function(e){s.close(),pop_win('<div style="padding: 5px 15px;">出错了</div>')}});else{var w=a('<form action="'+h+'" method="post"></form>');_.ck=get_cookie("ck"),Object.entries(_).forEach(function(e){var t=e[0],n=e[1];w.append(a('<input type="hidden" name="'+t+'" value="'+n+'">'))}),a("body").append(w),w.submit()}},width:420});return a(".rej-rsn").change(function(){if(a(this).hasClass("custom")){var e=a("textarea.ctm-rsn"),t=a(this).data("holder");e.length>0?e.attr("placeholder",t):a(".rej-cnt").append('<textarea class="ctm-rsn" type="text" name="rej-rsn-custom" placeholder="'+t+'" />'),a("textarea.ctm-rsn").focus()}else a("textarea.ctm-rsn").remove();var n=a(this).next(".reason-desc");n.length>0&&(a(".rej-cnt").find(".reason-desc, .full-rsn-desc").hide(),n.show()),g.update()}),a("a.show-full").click(function(e){a(this).parents("p").eq(0).hide().siblings("p.full-rsn-desc").show(),g.update()}),!1}a(".ban-dialog-confirm").click(function(e){return e.preventDefault(),n("ban",a(e.target))}),a(".remove-topic-dialog-confirm").click(function(e){return e.preventDefault(),n("delete_topic",a(e.target))}),a(".kick-dialog-confirm, .promote-dialog-confirm, .ban-dialog-confirm").click(function(){var e=a(this),t=e.attr("href");return generate_group_prompt_dialog({content:"真的要"+e.attr("title")+"？",prompt:e.hasClass("promote-dialog-confirm")?null:"同时删除该成员在本小组的所有回复",checked:!1,callback:function(e){a(".action-dialog-prompt input").attr("checked")&&(t+="&delete_all=1"),e.close(),window.location=t}}),!1}),window.create_dialog=n}()}();